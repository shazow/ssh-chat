sudo: required
services:
  - docker

language: go

notifications:
  email: false

install:
  - export PATH=$PATH:$HOME/gopath/bin
  - go get github.com/GeertJohan/fgt
  - go get github.com/golang/lint/golint
  - make deps

go:
  - 1.4

script:
  # TODO: Bring this back: - fgt golint
  # - make test
  - CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -ldflags "-X main.buildCommit `git describe --long --tags --dirty --always`" ./cmd/ssh-chat
  - ssh-keygen -f ~/.ssh/id_rsa -t rsa -N ''
  - cp ~/.ssh/id_rsa id_rsa
  - docker build -t "$DOCKER_USER"/ssh-chat:latest .

after_success:
  - test $TRAVIS_PULL_REQUEST == "false" && test $TRAVIS_BRANCH == "master"
  - docker login -e="$DOCKER_EMAIL" -u="$DOCKER_USER" -p="$DOCKER_PASS"
  - docker push $DOCKER_USER/ssh-chat:latest
